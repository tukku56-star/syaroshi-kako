# リアルタイムログビューアー実装完了

並列パトロールボットで収集したチャットログをリアルタイムで閲覧できるWebアプリケーションを作成しました。

## 作成したファイル

### バックエンド: [log_viewer.py](file:///c:/Users/admin/.gemini/antigravity/scratch/log_viewer.py)

Flask + Socket.IOベースのリアルタイムログビューアーサーバー:
- [logs/](file:///c:/Users/admin/.gemini/antigravity/scratch/logs)ディレクトリを2秒ごとに監視
- JSONログファイルの変更を検出
- Socket.IOでブラウザにリアルタイム通知
- REST API for room list and messages

主な機能:
- [scan_logs()](file:///c:/Users/admin/.gemini/antigravity/scratch/log_viewer.py#17-52) - 全ログファイルをスキャンして部屋情報取得
- [get_room_messages()](file:///c:/Users/admin/.gemini/antigravity/scratch/log_viewer.py#53-89) - 特定の部屋のメッセージを取得
- [monitor_logs()](file:///c:/Users/admin/.gemini/antigravity/scratch/log_viewer.py#90-129) - バックグラウンドでログファイルを監視
- WebSocket通信でリアルタイム更新通知

### フロントエンド: [viewer.html](file:///c:/Users/admin/.gemini/antigravity/scratch/templates/viewer.html)

モダンなグラデーションデザインのWebインターフェース:
- 2カラムレイアウト(部屋リスト + チャット表示)
- Socket.IO Clientでリアルタイム接続
- 検索・フィルター機能
- スムーズなアニメーション

## 使い方

### 1. 依存関係インストール

```bash
pip install -r requirements_viewer.txt
```

必要なパッケージ:
- Flask==3.0.0
- Flask-SocketIO==5.3.5
- python-socketio==5.10.0

### 2. ビューアー起動

```bash
python log_viewer.py
```

起動時の表示:
```
============================================================
🚀 リアルタイムログビューアー起動中...
📂 ログディレクトリ: C:\Users\admin\.gemini\antigravity\scratch\logs
🌐 ブラウザで開く: http://localhost:5000
============================================================
📂 ログ監視開始...
```

### 3. ブラウザでアクセス

http://localhost:5000 を開くとビューアーが表示されます

## 主な機能

### 📊 リアルタイム統計
- 監視中の部屋数
- 総メッセージ数
- 接続ステータス(リアルタイム接続中の表示)

### 💬 部屋一覧
- 全部屋が左サイドバーに表示
- 各部屋のメッセージ数と最終更新時刻
- 部屋名で検索可能
- クリックで部屋を選択

### 📨 メッセージ表示
- タイムライン形式で表示
- ユーザー名と投稿時刻
- 新着メッセージは自動的にスムーズに追加
- 下から上に時系列でスクロール

### 🔄 リアルタイム更新
- ログファイルが更新されると即座に反映
- Socket.IOで双方向通信
- ページリロード不要

### 🎨 デザイン
- モダンなグラデーション(紫〜青)
- Glassmorphismデザイン
- スムーズなアニメーション
- レスポンシブレイアウト

## 技術スタック

- **Flask 3.0.0** - Webフレームワーク
- **Flask-SocketIO 5.3.5** - WebSocket通信
- **Socket.IO Client 4.5.4** - フロントエンドWebSocket
- **Threading** - バックグラウンドファイル監視

## 動作フロー

1. **起動時**:
   - Flaskサーバーが5000番ポートで起動
   - バックグラウンドスレッドがログ監視開始
   - [logs/](file:///c:/Users/admin/.gemini/antigravity/scratch/logs)ディレクトリの全JSONファイルをスキャン

2. **ブラウザ接続時**:
   - Socket.IO接続確立
   - 部屋一覧をAPI経由で取得
   - 統計情報を表示

3. **部屋選択時**:
   - 選択した部屋のメッセージをAPI経由で取得(最大200件)
   - メッセージをタイムライン表示

4. **ログ更新時**:
   - 2秒ごとにファイルの更新時刻をチェック
   - 更新されたファイルを検出
   - Socket.IOでブラウザに`room_updated`イベント送信
   - フロントエンドが部屋リストを再取得

## 検証結果

✅ **サーバー起動成功** - http://localhost:5000で稼働中
✅ **ログ監視機能** - [logs/](file:///c:/Users/admin/.gemini/antigravity/scratch/logs)ディレクトリを2秒間隔でチェック
✅ **Socket.IO接続** - WebSocket通信確立
✅ **REST API** - `/api/rooms`と`/api/room/<id>/messages`が動作
✅ **リアルタイム更新** - ファイル変更を検出してブラウザに通知

## 並列パトロールボットとの連携

1. **パトロールボット起動**:
   ```bash
   python parallel_patrol_bot.py
   ```
   → [logs/](file:///c:/Users/admin/.gemini/antigravity/scratch/logs)ディレクトリにJSONファイルが生成される

2. **ビューアー起動**（別ターミナル）:
   ```bash
   python log_viewer.py
   ```
   → リアルタイムでログを監視

3. **ブラウザでモニタリング**:
   → 新しいメッセージが自動的に表示される

これにより、チャットデータ収集とリアルタイム閲覧を同時に実行できます!
