# drrrkari.com システム再構築およびデータフォレンジック 実装計画

## 目的
失われた「drrrkari.com」自動ログ収集システムの動作原理を、残されたデータアーティファクトから逆算（リバースエンジニアリング）し、再構築する。また、現存するデータセットを解析し、利用可能な形式で保存する。

## ユーザーレビュー要件
- **データ形式の特定**: 調査フェーズで発見されたデータ形式（HAR, JSON, HTML等）に基づき、解析アプローチを決定する際に確認を求める。
- **収集手法の選択**: Selenium（ブラウザ自動化）か APIラッパー（Requests）か、痕跡に基づいて決定した実装方針について合意を得る。

## 提案される変更

### 1. フォレンジック調査と環境定義
- **探索対象**: `cookies/`, `*.har`, `*.json`, `*.db`, `geckodriver.log` 等のファイル。
- **判定基準**:
    - `cookies` フォルダや `config.json` があれば **APIベース** と判断。
    - `geckodriver.log` や HTML断片があれば **Seleniumベース** と判断。

### 2. システム再構築 (Python)
#### [NEW] `collector.py` (仮)
- **機能**: サイトへのログイン、ルーム入室、メッセージ監視。
- **実装詳細**:
    - `requests` または `selenium` を使用。
    - `startLoop` 相当のポーリング機構。
    - セッション維持（Cookie管理）。

#### [NEW] `parser.py` (仮)
- **機能**: 既存のログデータおよび新規収集データの解析。
- **実装詳細**:
    - HAR/JSON/HTML のパース処理。
    - スパム（`jump.php`）のフィルタリング。
    - CSV/SQLite へのエクスポート。

## 検証計画

### 自動テスト
- **単体テスト**: パーサーがサンプルデータを正しく構造化データに変換できるか検証。
- **接続テスト**: `collector.py` が（もしサイトが現存すれば）ログインおよび入室に成功するか確認。

### 手動検証
- 生成された CSV/SQLite ファイルを開き、会話ログが人間可読な状態で復元されているか確認。
